# Constrained Combinatorial Interaction Testing

# Setup
Running this program requires GCC and z3 solver installed.

Follow the instruction at https://github.com/Z3Prover/z3/tree/master for installing the z3 solver using the C++ compiler.

Run the below commands to update the path variables.
```
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:<path to z3 on your machine>/z3/build/

export PATH=$PATH:<path to z3>/z3/build/:<path to z3 on your machine>/z3/build/api

export PYTHONPATH=$PYTHONPATH:<path to z3>/z3/build/python
```
Build `maetg` executable using the below commands.
```
cd src

make clean && make
```

# Usage

```
./maetg <inputs file> <avoids file> -r <repetitions> -d <target density>

inputs file: This file requires CIT configuration.
The first line of the file should be the strength t of CIT.
The second line should be the number of factors of CIT, which is the number of non-noise latent dimensions of the VAE.
The third line has two space separated entities, 1) number of levels, i.e., number of partitions along each latent dimension and 2) number of factors of CIT.

Example inputs file:
Please refer to src/idc-inputs-9.txt for an instanciation of the inputs file for the MNIST experiment.
RCCA is generated for strength t=3, the number of non-noise latent dimensions of MNIST VAE is 9, and each latent dimension is partitioned into 20 intervals. 

avoids file: This is required for running the AETG-SAT algorithm which is not used by CIT4DNN.
Use the provided empty file, idc-avoids.txt, for this argument.

repetitions: The original algorithm runs r times and selects the best covering array. This can be left as 1 for the CIT4DNN experiments.

target density: This parameter refers to the target density mentioned in the paper. We used five target densities, D1-D5, in the paper.
These target densities are referred to as Level[1-5] in the experiments.
```

This program generates a log file, aetglog_z\<factors\>\_p\<levels\>\_t\<t\>\<target density tag\>.out, and an RCCA, aetg_z\<factors\>\_p\<levels\>\_t\<t\>\<target density tag\>.out in the [Results/CoveringArrays](https://github.com/less-lab-uva/CIT4DNN/tree/main/Results/CoveringArrays) directory.

Below command is used for generating RCCA for the MNIST experiments for the target density D1 mentioned in the paper.
```
./maetg idc-inputs-9.txt idc-avoids.txt -r 1 -d Level1
```
The above program generates aetlog_z9_p20_t3Level1.out and aetg_z9_p20_t3Level1.out in the [Results/CoveringArrays](https://github.com/less-lab-uva/CIT4DNN/tree/main/Results/CoveringArrays) directory.

## Target Density Configuration
The target density configurations are generated by running [gen_bounds_targetdensities.py](https://github.com/less-lab-uva/CIT4DNN/tree/main/gen_bounds_targetdensities.py).

Users can run the experiments for custom target densities by changing the `gen_bounds_targetdensities.py` script.

Four files are generated by the script for each target density at [Config](https://github.com/less-lab-uva/CIT4DNN/tree/main/Config) directory.
1. densities_z\<factors\>.init: This is a metadata file and it contains a tag for each target density (e.g., Level1, Level2, etc), cumulative density, cumulative densities of the inner and the outer shells. 
2. boundaries_z\<factors\>\_p\<levels\>\_\<target density tag\>\_i.txt and boundaries_z\<factors\>_p\<levels\>_\<levels\>_o.txt files including the radial boundaries of the inner and outer shell
3. partitions_z\<factors\>\_p\<levels\>\_\<target density tag\>.txt files including the partition boundaries of the latent dimensions.
